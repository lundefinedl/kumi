rasterizer_desc BackfaceCulling { 
  cull_mode = back; 
};

rasterizer_desc NoCulling { 
  cull_mode = back; 
};

depth_stencil_desc DepthEnable { 
  depth_enable = true; 
};

depth_stencil_desc DepthDisable { 
  depth_enable = false; 
};

blend_desc BlendDisable {
  render_target[0] = {
    blend_enable = false;
  };
};

blend_desc BlendOneOne {
  render_target[0] = {
    blend_enable = true;
    src_blend = one;
    dest_blend = one;
  };
};

sampler_desc PointSampler {
  filter = min_mag_mip_point;
  address_u = clamp;
  address_v = clamp;
};

sampler_desc LinearSampler {
  filter = min_mag_mip_linear;
  address_u = clamp;
  address_v = clamp;
};

technique ssao_fill {
    
    vertex_shader {
        file effects/ssao.fx;
        entry_point fill_vs_main;
        params [
            float4x4 view system;
            float4x4 proj system;
            float4x4 world mesh;
        ];
    };
    
    pixel_shader {
        file effects/ssao.fx;
        entry_point fill_ps_main;
        params [
            texture2d DiffuseTexture Diffuse material;
            float4 Diffuse material;
            float4 Specular material;
            float Shininess material;
        ];
        flags [ DIFFUSE_TEXTURE ];
    };

    rasterizer_desc = BackfaceCulling;
    depth_stencil_desc = DepthEnable;
    blend_desc = BlendDisable;
};

technique ssao_compute {
    
    vertex_shader {
        file effects/ssao.fx;
        entry_point render_vs_main;
    };
    
    pixel_shader {
        file effects/ssao.fx;
        entry_point render_ps_main;
        params [
            float4x4 proj system;
            texture2d rt_pos system;
            texture2d rt_normal system;
            texture2d random_normals system;
            float4[32] kernel system;
            float4[16] noise system;
        ];
    };
   
  geometry = fs_quad_postex;
  
  rasterizer_desc = NoCulling;
  depth_stencil_desc = DepthDisable;
  blend_desc = BlendDisable;
};

technique ssao_blur {
    
    vertex_shader {
        file effects/ssao.fx;
        entry_point blur_vs_main;
    };
    
    pixel_shader {
        file effects/ssao.fx;
        entry_point blur_ps_main;
        params [
            texture2d rt_occlusion_tmp system;
        ];
    };
   
  geometry = fs_quad_postex;
  
  rasterizer_desc = NoCulling;
  depth_stencil_desc = DepthDisable;
  blend_desc = BlendDisable;
};


technique ssao_ambient {
    vertex_shader {
        file effects/ssao.fx;
        entry_point ambient_vs_main;
    };
    
    pixel_shader {
        file effects/ssao.fx;
        entry_point ambient_ps_main;
        params [
            texture2d rt_occlusion system;
            float4 Ambient system;
        ];
    };
   
  geometry = fs_quad_postex;
  
  rasterizer_desc = NoCulling;
  depth_stencil_desc = DepthDisable;
  blend_desc = BlendDisable;
};


technique ssao_light {
    vertex_shader {
        file effects/ssao.fx;
        entry_point light_vs_main;
    };
    
    pixel_shader {
        file effects/ssao.fx;
        entry_point light_ps_main;
        params [
            texture2d rt_pos system;
            texture2d rt_normal system;
            texture2d rt_diffuse system;
            texture2d rt_specular system;
            float4 LightPos instance;
            float4 LightColor instance;
            float AttenuationStart instance;
            float AttenuationEnd instance;
        ];
    };
   
  geometry = fs_quad_postex;
  
  rasterizer_desc = NoCulling; 
  depth_stencil_desc = DepthDisable;
  blend_desc = BlendOneOne;
};


technique gamma_correction {
    vertex_shader {
        file effects/ssao.fx;
        entry_point gamma_vs_main;
    };
    
    pixel_shader {
        file effects/ssao.fx;
        entry_point gamma_ps_main;
        params [
            texture2d rt_composite system;
            texture2d rt_luminance system;
        ];
    };
   
  geometry = fs_quad_postex;
   
  rasterizer_desc = NoCulling;
  depth_stencil_desc = DepthDisable;
  blend_desc = BlendDisable;
};
